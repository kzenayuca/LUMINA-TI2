<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Disponibilidad de Aulas y Laboratorios</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary: #3498db;
  --secondary: #2c3e50;
  --accent: #9b59b6;
  --success: #2ecc71;
  --warning: #f39c12;
  --danger: #e74c3c;
  --info: #1abc9c;
  --light: #ecf0f1;
  --dark: #2c3e50;
  --card-bg: rgba(255, 255, 255, 0.95);
  --shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  --my-reservation: #1a5276; 
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #333;
  min-height: 100vh;
  padding: 20px;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
}

.header {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 20px 30px;
  box-shadow: var(--shadow);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header h1 {
  color: var(--secondary);
  font-size: 2rem;
  display: flex;
  align-items: center;
  gap: 15px;
}

.header h1 i {
  color: var(--primary);
}

.user-info {
  display: flex;
  align-items: center;
  gap: 12px;
  background: rgba(52, 152, 219, 0.1);
  padding: 10px 18px;
  border-radius: 10px;
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(45deg, var(--primary), var(--accent));
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.1rem;
}

.user-name {
  font-weight: 600;
  color: var(--secondary);
}

.user-department {
  font-size: 0.85rem;
  color: #7f8c8d;
}

.controls-panel {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 20px;
  box-shadow: var(--shadow);
  margin-bottom: 20px;
}

.filters-row {
  display: flex;
  gap: 20px;
  margin-bottom: 15px;
  align-items: flex-end;
  flex-wrap: wrap;
}

.filter-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex: 1;
  min-width: 180px;
}

.filter-group label {
  font-weight: 600;
  color: var(--secondary);
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
}

.filter-group select, .filter-group input {
  padding: 10px 12px;
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  background: white;
  font-size: 0.9rem;
  transition: all 0.3s;
}

.filter-group select:focus, .filter-group input:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
  outline: none;
}

.actions-row {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 18px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  font-size: 0.9rem;
}

.btn-primary {
  background-color: var(--primary);
  color: white;
}

.btn-primary:hover {
  background-color: #2980b9;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
}

.btn-success {
  background-color: var(--success);
  color: white;
}

.btn-success:hover {
  background-color: #27ae60;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
}

.btn-danger {
  background-color: var(--danger);
  color: white;
}

.btn-danger:hover {
  background-color: #c0392b;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
}

.btn-info {
  background-color: var(--info);
  color: white;
}

.btn-info:hover {
  background-color: #17a2b8;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4);
}

.btn-secondary {
  background-color: #95a5a6;
  color: white;
}

.btn-secondary:hover {
  background-color: #7f8c8d;
  transform: translateY(-2px);
}

.ambientes-container {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
  transition: all 0.3s;
}

.ambientes-container.compact {
  grid-template-columns: 350px 1fr;
}

.ambientes-panel {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 20px;
  box-shadow: var(--shadow);
  transition: all 0.3s;
  max-height: 600px;
  overflow: hidden;
}

.ambientes-panel.compact {
  position: sticky;
  top: 20px;
  max-height: 80vh;
  overflow-y: auto;
}

.ambientes-panel.compact::-webkit-scrollbar {
  width: 6px;
}

.ambientes-panel.compact::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.ambientes-panel.compact::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 10px;
}

.ambientes-panel.compact::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

.panel-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #eee;
}

.panel-title h2 {
  margin: 0;
  color: var(--secondary);
  font-size: 1.4rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.ambientes-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  transition: all 0.3s;
}

.ambientes-panel.compact .ambientes-grid {
  grid-template-columns: 1fr;
  gap: 15px;
}

.ambiente-card {
  background-color: white;
  border-radius: 12px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  border-left: 4px solid var(--primary);
  position: relative;
  overflow: hidden;
}

.ambiente-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--accent));
  opacity: 0;
  transition: opacity 0.3s;
}

.ambiente-card.lab {
  border-left-color: var(--accent);
}

.ambiente-card.lab::before {
  background: linear-gradient(90deg, var(--accent), var(--info));
}

.ambiente-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}

.ambiente-card:hover::before {
  opacity: 1;
}

.ambiente-card.selected {
  border-color: var(--primary);
  background-color: #f0f9ff;
  box-shadow: 0 8px 20px rgba(52, 152, 219, 0.2);
}

.ambiente-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.ambiente-name {
  font-size: 1.2rem;
  font-weight: bold;
  color: var(--primary);
}

.ambiente-type {
  background: var(--primary);
  color: white;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 500;
}

.ambiente-type.lab {
  background: var(--accent);
}

.ambiente-details {
  font-size: 0.9rem;
  color: #555;
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 15px;
}

.ambiente-detail {
  display: flex;
  align-items: center;
  gap: 8px;
}

.ambiente-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.favorite-btn {
  background: none;
  border: none;
  color: #ddd;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s;
  padding: 5px;
  border-radius: 50%;
}

.favorite-btn:hover {
  color: #f1c40f;
  background: rgba(241, 196, 15, 0.1);
}

.favorite-btn.active {
  color: #f1c40f;
}

/* Panel de horario */
.horario-panel {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 20px;
  box-shadow: var(--shadow);
  transition: all 0.3s;
  display: none;
}

.ambientes-container.compact .horario-panel {
  display: block;
}

.horario-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #eee;
}

.horario-header h2 {
  margin: 0;
  color: var(--secondary);
  font-size: 1.4rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.horario-title {
  color: var(--primary);
  font-size: 1.2rem;
  margin-bottom: 15px;
  font-weight: 600;
}

.schedule-container {
  overflow-x: auto;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.schedule-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
  border-radius: 12px;
  overflow: hidden;
}

.schedule-table th, .schedule-table td {
  border: 1px solid #e8e8e8;
  text-align: center;
  padding: 12px 8px;
}

.schedule-table th {
  background-color: var(--secondary);
  color: white;
  font-weight: 600;
  position: sticky;
  top: 0;
}

.schedule-table td {
  height: 70px;
  vertical-align: top;
  position: relative;
}

.time-cell {
  font-weight: 600;
  background-color: #f8f9fa;
  color: var(--secondary);
}

.ocupado {
  background-color: #fff5f5;
  color: #e74c3c;
  border-radius: 6px;
  padding: 4px;
  font-size: 0.75rem;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  border-left: 3px solid #e74c3c;
}

.disponible {
  background-color: #f0fff4;
  color: #27ae60;
  cursor: pointer;
  transition: all 0.2s;
  border-radius: 6px;
  padding: 4px;
  font-size: 0.75rem;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  border-left: 3px solid #27ae60;
}

.disponible:hover {
  background-color: #e6ffed;
  transform: scale(1.02);
}

.mi-reserva {
  background-color: var(--my-reservation);
  color: white;
  border-radius: 6px;
  padding: 4px;
  font-size: 0.75rem;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  border-left: 3px solid #0d47a1;
}

.reserva-parcial {
  position: relative;
  height: 100%;
  border-radius: 6px;
  overflow: hidden;
}

.parte-reservada {
  background-color: var(--my-reservation);
  color: white;
  padding: 2px 4px;
  font-size: 0.7rem;
  position: absolute;
  left: 0;
  right: 0;
  border-left: 3px solid #0d47a1;
}

.parte-disponible {
  background-color: #f0fff4;
  color: #27ae60;
  padding: 2px 4px;
  font-size: 0.7rem;
  position: absolute;
  left: 0;
  right: 0;
  cursor: pointer;
  transition: all 0.2s;
  border-left: 3px solid #27ae60;
}

.parte-disponible:hover {
  background-color: #e6ffed;
  transform: scale(1.02);
}

.curso-nombre {
  font-weight: 600;
  font-size: 0.75rem;
}

.curso-detalle {
  font-size: 0.65rem;
  margin-top: 2px;
}

.mis-reservas-panel {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 20px;
  box-shadow: var(--shadow);
  margin-bottom: 20px;
  display: none;
}

.mis-reservas-panel.active {
  display: block;
}

.mis-reservas-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #eee;
}

.mis-reservas-header h2 {
  margin: 0;
  color: var(--secondary);
  font-size: 1.4rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.reservas-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 15px;
}

.reserva-card {
  background-color: white;
  border-left: 4px solid var(--primary);
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  transition: all 0.3s;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.reserva-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.1);
}

.reserva-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.reserva-info h4 {
  margin: 0 0 5px 0;
  color: var(--primary);
  font-size: 1.1rem;
}

.reserva-details {
  font-size: 0.85rem;
  color: #444;
  line-height: 1.4;
}

.reserva-actions {
  display: flex;
  justify-content: flex-end;
  margin-top: 5px;
}

.no-reservas {
  text-align: center;
  padding: 40px 20px;
  color: #7f8c8d;
  grid-column: 1 / -1;
}

.no-reservas i {
  font-size: 3rem;
  margin-bottom: 15px;
  color: #bdc3c7;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: white;
  border-radius: 16px;
  padding: 30px;
  width: 100%;
  max-width: 500px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: modalAppear 0.3s ease-out;
}

@keyframes modalAppear {
  from {
    opacity: 0;
    transform: translateY(-20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 1px solid #eee;
}

.modal-header h2 {
  color: var(--secondary);
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 0;
}

.close-modal {
  background: none;
  border: none;
  font-size: 1.5rem;
  color: #7f8c8d;
  cursor: pointer;
  transition: color 0.3s;
}

.close-modal:hover {
  color: var(--danger);
}

.reserva-form {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-group.full-width {
  grid-column: 1 / -1;
}

.form-group label {
  font-weight: 600;
  color: var(--secondary);
  font-size: 0.9rem;
}

.form-group input, .form-group select, .form-group textarea {
  padding: 12px 15px;
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  font-size: 0.9rem;
  background: white;
  transition: all 0.3s;
}

.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
  outline: none;
}

.form-group textarea {
  min-height: 100px;
  resize: vertical;
}

.rango-info {
  background: #f0f9ff;
  padding: 15px;
  border-radius: 10px;
  margin: 15px 0;
  border-left: 4px solid var(--info);
  font-size: 0.9rem;
  grid-column: 1 / -1;
}

.form-actions {
  grid-column: 1 / -1;
  display: flex;
  justify-content: flex-end;
  gap: 15px;
  margin-top: 20px;
}

.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 15px 25px;
  border-radius: 10px;
  color: white;
  font-weight: 500;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  z-index: 1100;
  display: flex;
  align-items: center;
  gap: 10px;
  transform: translateX(150%);
  transition: transform 0.5s;
}

.notification.show {
  transform: translateX(0);
}

.notification.success {
  background: var(--success);
}

.notification.error {
  background: var(--danger);
}

@media (max-width: 1024px) {
  .ambientes-grid {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  }
  
  .reserva-form {
    grid-template-columns: 1fr;
  }
  
  .ambientes-container.compact {
    grid-template-columns: 1fr;
  }
  
  .ambientes-panel.compact {
    position: relative;
    max-height: 400px;
  }
}

@media (max-width: 768px) {
  .header {
    flex-direction: column;
    gap: 15px;
    text-align: center;
  }
  
  .filters-row {
    flex-direction: column;
    gap: 15px;
  }
  
  .filter-group {
    min-width: 100%;
  }
  
  .actions-row {
    justify-content: center;
  }
  
  .reservas-container {
    grid-template-columns: 1fr;
  }
  
  .modal-content {
    padding: 20px;
  }
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="header-left">
      <h1><i class="fas fa-door-open"></i> Disponibilidad de Aulas y Laboratorios</h1>
    </div>
    <div class="header-right">
      <div class="user-info">
        <div class="user-avatar">
          <i class="fas fa-user-tie"></i>
        </div>
        <div>
          <div class="user-name">Prof. Carlos Rodríguez</div>
          <div class="user-department">Ciencias de la Computación</div>
        </div>
      </div>
    </div>
  </div>

  <div class="controls-panel">
    <div class="filters-row">
      <div class="filter-group">
        <label for="filter-type"><i class="fas fa-door-open"></i> Tipo de Ambiente</label>
        <select id="filter-type">
          <option value="">Todos los tipos</option>
          <option value="theory">Aula de Teoría</option>
          <option value="lab">Laboratorio</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="filter-capacity"><i class="fas fa-users"></i> Capacidad Mínima</label>
        <input type="number" id="filter-capacity" min="1" max="200" placeholder="Ej: 30">
      </div>
      
      <div class="filter-group">
        <label for="filter-favorites"><i class="fas fa-star"></i> Mostrar</label>
        <select id="filter-favorites">
          <option value="all">Todos los ambientes</option>
          <option value="favorites">Solo favoritos</option>
        </select>
      </div>
    </div>
    
    <div class="actions-row">
      <button class="btn btn-info" id="btnMisReservas">
        <i class="fas fa-list-check"></i> Mis Reservas
      </button>
    </div>
  </div>

  <!-- Contenedor de ambientes y horario -->
  <div class="ambientes-container" id="ambientesContainer">
    <!-- Panel de ambientes -->
    <div class="ambientes-panel" id="ambientesPanel">
      <div class="panel-title">
        <h2><i class="fas fa-list"></i> Ambientes Disponibles</h2>
        <span id="ambiente-count">6 ambientes</span>
      </div>
      
      <div class="ambientes-grid" id="ambientesGrid"></div>
    </div>

    <!-- Panel de horario -->
    <div class="horario-panel" id="horarioSection">
      <div class="horario-header">
        <h2><i class="fas fa-calendar-alt"></i> Horario del Ambiente</h2>
        <button class="btn btn-secondary" onclick="cambiarAmbiente()">
          <i class="fas fa-exchange-alt"></i> Cambiar Ambiente
        </button>
      </div>
      <div class="horario-title" id="nombreAmbiente"></div>
      
      <div class="schedule-container">
        <table class="schedule-table">
          <thead>
            <tr>
              <th>Hora</th>
              <th>Lunes</th>
              <th>Martes</th>
              <th>Miércoles</th>
              <th>Jueves</th>
              <th>Viernes</th>
            </tr>
          </thead>
          <tbody id="horarioCompleto"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Panel de mis Reservas -->
  <div class="mis-reservas-panel" id="misReservasSection">
    <div class="mis-reservas-header">
      <h2><i class="fas fa-list-check"></i> Mis Reservas</h2>
      <button class="btn btn-secondary" onclick="cerrarMisReservas()">
        <i class="fas fa-times"></i> Cerrar
      </button>
    </div>
    
    <div class="reservas-container" id="listaReservas"></div>
  </div>
</div>

<!-- Modal de Reserva -->
<div class="modal" id="reservaModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2><i class="fas fa-calendar-plus"></i> Nueva Reserva</h2>
      <button class="close-modal" id="closeModal">&times;</button>
    </div>
    
    <div class="rango-info">
      <strong><i class="fas fa-calendar-day"></i> Día seleccionado:</strong> <span id="diaSeleccionado">-</span><br>
      <strong><i class="fas fa-clock"></i> Bloque seleccionado:</strong> <span id="bloqueSeleccionado">-</span><br>
      <strong><i class="fas fa-hourglass"></i> Rango disponible:</strong> <span id="rangoDisponible">-</span><br>
      <strong><i class="fas fa-user-tie"></i> Responsable:</strong> <span id="responsableInfo">Prof. Carlos Rodríguez</span>
    </div>
    
    <form class="reserva-form" id="reservaForm">
      <div class="form-group">
        <label><i class="fas fa-play-circle"></i> Hora inicio</label>
        <select id="horaInicio" required>
          <option value="">Seleccionar hora inicio</option>
        </select>
      </div>
      
      <div class="form-group">
        <label><i class="fas fa-stop-circle"></i> Hora fin</label>
        <select id="horaFin" required>
          <option value="">Seleccionar hora fin</option>
        </select>
      </div>
      
      <div class="form-group full-width">
        <label><i class="fas fa-tag"></i> Motivo</label>
        <select id="motivoReserva" required>
          <option value="">Seleccionar motivo</option>
          <option value="Clase de Programación">Clase de Programación</option>
          <option value="Taller de Base de Datos">Taller de Base de Datos</option>
          <option value="Laboratorio de Redes">Laboratorio de Redes</option>
          <option value="Seminario de IA">Seminario de IA</option>
          <option value="Reunión">Reunión</option>
          <option value="Examen">Examen</option>
          <option value="Otro">Otro</option>
        </select>
      </div>
      
      <div class="form-group full-width">
        <label><i class="fas fa-sticky-note"></i> Descripción adicional (opcional)</label>
        <textarea id="reservaDescripcion" placeholder="Describe el propósito de tu reserva..."></textarea>
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
        <button type="submit" class="btn btn-success">Confirmar Reserva</button>
      </div>
    </form>
  </div>
</div>

<!-- Notificación -->
<div class="notification" id="notification">
  <i class="fas fa-check-circle"></i>
  <span id="notification-text">Reserva realizada con éxito</span>
</div>

<script>

const ambientes = [
  { id:"A101", nombre:"Aula 101", tipo:"theory", capacidad:40, equipos:["Proyector", "WiFi", "Pizarra"] },
  { id:"A102", nombre:"Aula 102", tipo:"theory", capacidad:35, equipos:["Proyector", "WiFi"] },
  { id:"A103", nombre:"Aula 103", tipo:"theory", capacidad:45, equipos:["Proyector", "WiFi", "Pizarra Digital"] },
  { id:"Lab201", nombre:"Laboratorio 201", tipo:"lab", capacidad:25, equipos:["Computadoras", "Red", "Software"] },
  { id:"Lab202", nombre:"Laboratorio 202", tipo:"lab", capacidad:30, equipos:["Computadoras", "Servidores", "Red"] },
  { id:"Lab203", nombre:"Laboratorio 203", tipo:"lab", capacidad:20, equipos:["Computadoras", "Tablets", "Software IA"] }
];

// Horarios en intervalos de 10 minutos
const horarios = [];
for (let h = 7; h <= 18; h++) {
  for (let m = 0; m < 60; m += 10) {
    if (h === 18 && m > 40) break; // Último horario a las 18:40
    horarios.push(`${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`);
  }
}

const dias = ["Lunes","Martes","Miércoles","Jueves","Viernes"];

let ambienteSel = null;
let misReservas = [];
let ambientesFavoritos = JSON.parse(localStorage.getItem('ambientesFavoritos')) || [];

// simualcion  profesor actual es "Prof. Carlos Rodríguez"
const profesorActual = "Prof. Carlos Rodríguez";

// Datos de ejemplo 
let reservasExistentes = [
  
  { ambiente:"A101", dia:"Lunes", horaInicio:"07:00", horaFin:"07:50", curso:"Programación I", profesor:"Dr. Pérez" },
  { ambiente:"A101", dia:"Lunes", horaInicio:"08:40", horaFin:"09:30", curso:"Algoritmos", profesor:"Dra. López" },
  { ambiente:"A101", dia:"Lunes", horaInicio:"10:20", horaFin:"11:10", curso:"Estructuras de Datos", profesor:"Dr. González" },
  { ambiente:"A101", dia:"Martes", horaInicio:"09:30", horaFin:"10:20", curso:"Base de Datos", profesor:"Dra. Martínez" },
  { ambiente:"A101", dia:"Martes", horaInicio:"11:10", horaFin:"12:00", curso:"Sistemas Operativos", profesor:"Dr. Rodríguez" },
  { ambiente:"A101", dia:"Miércoles", horaInicio:"07:50", horaFin:"08:40", curso:"Redes", profesor:"Dra. Sánchez" },
  { ambiente:"A101", dia:"Miércoles", horaInicio:"14:30", horaFin:"15:20", curso:"Seguridad Informática", profesor:"Dr. Torres" },
  { ambiente:"A101", dia:"Jueves", horaInicio:"12:00", horaFin:"12:50", curso:"Inteligencia Artificial", profesor:"Dra. Ramírez" },
  { ambiente:"A101", dia:"Jueves", horaInicio:"15:20", horaFin:"16:10", curso:"Machine Learning", profesor:"Dr. Flores" },
  { ambiente:"A101", dia:"Viernes", horaInicio:"08:40", horaFin:"09:30", curso:"Desarrollo Web", profesor:"Dra. Silva" },
  
  { ambiente:"A102", dia:"Lunes", horaInicio:"09:30", horaFin:"10:20", curso:"Programación II", profesor:"Ing. Gómez" },
  { ambiente:"A102", dia:"Lunes", horaInicio:"11:10", horaFin:"12:00", curso:"Bases de Datos Avanzadas", profesor:"Ing. Castro" },
  { ambiente:"A102", dia:"Martes", horaInicio:"07:00", horaFin:"07:50", curso:"Redes de Computadoras", profesor:"Ing. Morales" },
  { ambiente:"A102", dia:"Martes", horaInicio:"13:40", horaFin:"14:30", curso:"Sistemas Distribuidos", profesor:"Ing. Ruiz" },
  { ambiente:"A102", dia:"Miércoles", horaInicio:"10:20", horaFin:"11:10", curso:"Ingeniería de Software", profesor:"Ing. Vargas" },
  { ambiente:"A102", dia:"Jueves", horaInicio:"08:40", horaFin:"09:30", curso:"Inteligencia Artificial", profesor:"Dra. Herrera" },
  { ambiente:"A102", dia:"Viernes", horaInicio:"12:00", horaFin:"12:50", curso:"Seguridad Informática", profesor:"Ing. Ortega" },
  
  { ambiente:"A103", dia:"Lunes", horaInicio:"08:40", horaFin:"09:30", curso:"Estadística para Computación", profesor:"Dr. Vargas" },
  { ambiente:"A103", dia:"Martes", horaInicio:"10:20", horaFin:"11:10", curso:"Cálculo para Computación", profesor:"Dra. Medina" },
  { ambiente:"A103", dia:"Miércoles", horaInicio:"12:00", horaFin:"12:50", curso:"Álgebra Lineal", profesor:"Dr. Rojas" },
  { ambiente:"A103", dia:"Jueves", horaInicio:"14:30", horaFin:"15:20", curso:"Matemáticas Discretas", profesor:"Dra. Castro" },
  { ambiente:"A103", dia:"Viernes", horaInicio:"09:30", horaFin:"10:20", curso:"Lógica Computacional", profesor:"Dr. Silva" },
  
  { ambiente:"Lab201", dia:"Lunes", horaInicio:"07:50", horaFin:"08:40", curso:"Lab. Programación", profesor:"Ing. Rojas" },
  { ambiente:"Lab201", dia:"Lunes", horaInicio:"10:20", horaFin:"11:10", curso:"Lab. Bases de Datos", profesor:"Ing. Medina" },
  { ambiente:"Lab201", dia:"Martes", horaInicio:"09:30", horaFin:"10:20", curso:"Lab. Redes", profesor:"Ing. Guzmán" },
  { ambiente:"Lab201", dia:"Miércoles", horaInicio:"08:40", horaFin:"09:30", curso:"Lab. Sistemas Operativos", profesor:"Ing. Paredes" },
  { ambiente:"Lab201", dia:"Jueves", horaInicio:"11:10", horaFin:"12:00", curso:"Lab. Ingeniería de Software", profesor:"Ing. Salazar" },
  { ambiente:"Lab201", dia:"Viernes", horaInicio:"13:40", horaFin:"14:30", curso:"Lab. Inteligencia Artificial", profesor:"Dra. Vega" },

  { ambiente:"Lab202", dia:"Lunes", horaInicio:"12:00", horaFin:"12:50", curso:"Lab. Desarrollo Web", profesor:"Dr. Mendoza" },
  { ambiente:"Lab202", dia:"Martes", horaInicio:"10:20", horaFin:"11:10", curso:"Lab. Programación Móvil", profesor:"Dra. Ríos" },
  { ambiente:"Lab202", dia:"Miércoles", horaInicio:"09:30", horaFin:"10:20", curso:"Lab. Base de Datos NoSQL", profesor:"Dr. Campos" },
  { ambiente:"Lab202", dia:"Jueves", horaInicio:"08:40", horaFin:"09:30", curso:"Lab. Seguridad", profesor:"Dra. Núñez" },
  { ambiente:"Lab202", dia:"Viernes", horaInicio:"11:10", horaFin:"12:00", curso:"Lab. Machine Learning", profesor:"Dr. Peña" },
  
  { ambiente:"Lab203", dia:"Lunes", horaInicio:"14:30", horaFin:"15:20", curso:"Lab. Realidad Virtual", profesor:"Dra. Ortega" },
  { ambiente:"Lab203", dia:"Martes", horaInicio:"13:40", horaFin:"14:30", curso:"Lab. Visión por Computadora", profesor:"Dr. Herrera" },
  { ambiente:"Lab203", dia:"Miércoles", horaInicio:"11:10", horaFin:"12:00", curso:"Lab. Procesamiento de Imágenes", profesor:"Dra. Ramírez" },
  { ambiente:"Lab203", dia:"Jueves", horaInicio:"10:20", horaFin:"11:10", curso:"Lab. Robótica", profesor:"Dr. Fuentes" },
  { ambiente:"Lab203", dia:"Viernes", horaInicio:"09:30", horaFin:"10:20", curso:"Lab. IoT", profesor:"Dra. Morales" }
];

//  Mostrar ambientes
function cargarAmbientes(){
  const grid = document.getElementById("ambientesGrid");
  
  // filtros
  const tipoFiltro = document.getElementById("filter-type").value;
  const capacidadFiltro = document.getElementById("filter-capacity").value;
  const favoritosFiltro = document.getElementById("filter-favorites").value;
  
  let ambientesFiltrados = ambientes.filter(a => {
    return (!tipoFiltro || a.tipo === tipoFiltro) &&
           (!capacidadFiltro || a.capacidad >= parseInt(capacidadFiltro));
  });
  
  // Filtrar por favoritos si está activo
  if (favoritosFiltro === "favorites") {
    ambientesFiltrados = ambientesFiltrados.filter(a => ambientesFavoritos.includes(a.id));
  }
  
  document.getElementById("ambiente-count").textContent = `${ambientesFiltrados.length} ambientes`;
  
  grid.innerHTML = ambientesFiltrados.map(a => {
    const esFavorito = ambientesFavoritos.includes(a.id);
    const tipoTexto = a.tipo === "theory" ? "Aula Teoría" : "Laboratorio";
    const tipoClase = a.tipo === "theory" ? "" : "lab";
    const esSeleccionado = ambienteSel && ambienteSel.id === a.id;
    
    return `<div class="ambiente-card ${tipoClase} ${esSeleccionado ? 'selected' : ''}" onclick="seleccionarAmbiente('${a.id}')">
      <div class="ambiente-header">
        <div class="ambiente-name">${a.nombre}</div>
        <div class="ambiente-type ${tipoClase}">${tipoTexto}</div>
      </div>
      <div class="ambiente-details">
        <div class="ambiente-detail">
          <i class="fas fa-users"></i>
          <span>Capacidad: ${a.capacidad} personas</span>
        </div>
        <div class="ambiente-detail">
          <i class="fas fa-microchip"></i>
          <span>${a.equipos.join(", ")}</span>
        </div>
      </div>
      <div class="ambiente-footer">
        <span class="status-available">Disponible</span>
        <button class="favorite-btn ${esFavorito ? 'active' : ''}" onclick="toggleFavorito(event, '${a.id}')">
          <i class="${esFavorito ? 'fas' : 'far'} fa-star"></i>
        </button>
      </div>
    </div>`;
  }).join("");
}

// Toggle favorito 
function toggleFavorito(event, idAmbiente) {
  event.stopPropagation();
  
  const index = ambientesFavoritos.indexOf(idAmbiente);
  if (index > -1) {
    ambientesFavoritos.splice(index, 1);
  } else {
    ambientesFavoritos.push(idAmbiente);
  }
  
  // Guardar en localStorage
  localStorage.setItem('ambientesFavoritos', JSON.stringify(ambientesFavoritos));
  
  mostrarNotificacion(index > -1 ? "Eliminado de favoritos" : "Añadido a favoritos", "success");
  cargarAmbientes();
}

// mostrar notificación 
function mostrarNotificacion(mensaje, tipo) {
  const notification = document.getElementById("notification");
  const notificationText = document.getElementById("notification-text");
  
  notificationText.textContent = mensaje;
  notification.className = "notification " + tipo + " show";
  
  setTimeout(() => {
    notification.classList.remove("show");
  }, 3000);
}

// seleccionar ambiente ¡
function seleccionarAmbiente(id){
  ambienteSel = ambientes.find(a => a.id === id);
  
  //  modo compacto
  const container = document.getElementById("ambientesContainer");
  const panel = document.getElementById("ambientesPanel");
  
  container.classList.add("compact");
  panel.classList.add("compact");
  
  document.getElementById("nombreAmbiente").textContent = ambienteSel.nombre;
  cargarAmbientes();
  cargarHorario();
}

function cambiarAmbiente(){
  ambienteSel = null;
  
  // desactivar modo compacto
  const container = document.getElementById("ambientesContainer");
  const panel = document.getElementById("ambientesPanel");
  
  container.classList.remove("compact");
  panel.classList.remove("compact");
  
  cargarAmbientes();
}

// Generar horario
function cargarHorario(){
  const tbody = document.getElementById("horarioCompleto");
  tbody.innerHTML = "";
  
  //  horarios en bloques de 50 minutos 
  const bloques = [];
  for(let i = 0; i < horarios.length; i += 5) {
    if(i + 5 <= horarios.length) {
      bloques.push({
        inicio: horarios[i],
        fin: horarios[i+5]
      });
    }
  }
  
  //  filas para cada bloque horario
  bloques.forEach(bloque => {
    let fila = `<tr><td class="time-cell">${bloque.inicio} - ${bloque.fin}</td>`;
    
    dias.forEach(dia => {
      // Verificar si hay reserva en este bloque
      const ocupaciones = reservasExistentes.filter(r => 
        r.ambiente === ambienteSel.id && 
        r.dia === dia && 
        estaEnBloque(r.horaInicio, r.horaFin, bloque.inicio, bloque.fin)
      );
      
      // Verificar si hay reservas mías en este bloque
      const misReservasEnBloque = misReservas.filter(r => 
        r.ambiente === ambienteSel.id && 
        r.dia === dia && 
        estaEnBloque(r.horaInicio, r.horaFin, bloque.inicio, bloque.fin)
      );
      
      // Combinar todas las reservas en este bloque
      const todasReservas = [...ocupaciones, ...misReservasEnBloque];
      
      if (todasReservas.length > 0) {
        // Hay reservas en este bloque
        if (todasReservas.length === 1 && 
            todasReservas[0].horaInicio === bloque.inicio && 
            todasReservas[0].horaFin === bloque.fin) {
          // La reserva ocupa todo el bloque
          const reserva = todasReservas[0];
          if (misReservasEnBloque.includes(reserva)) {
            fila += `<td><div class="mi-reserva">
              <div class="curso-nombre">Mi reserva</div>
              <div class="curso-detalle">${reserva.motivo}</div>
            </div></td>`;
          } else {
            fila += `<td><div class="ocupado">
              <div class="curso-nombre">${reserva.curso}</div>
              <div class="curso-detalle">${reserva.profesor}</div>
            </div></td>`;
          }
        } else {
          // Hay reservas parciales en el bloque
          fila += `<td><div class="reserva-parcial">`;
          
          // Ordenar reservas por hora de inicio
          todasReservas.sort((a, b) => horarios.indexOf(a.horaInicio) - horarios.indexOf(b.horaInicio));
          
          let tiempoActual = bloque.inicio;
          
          todasReservas.forEach(reserva => {
            // Añadir espacio disponible antes de la reserva si existe
            if (reserva.horaInicio !== tiempoActual) {
              const altura = calcularAltura(tiempoActual, reserva.horaInicio, bloque);
              fila += `<div class="parte-disponible" style="top: ${calcularPosicion(tiempoActual, bloque)}%; height: ${altura}%" onclick="abrirModalDesdeParte('${dia}', '${tiempoActual}', '${reserva.horaInicio}')"></div>`;
            }
            
            // Añadir la reserva
            const alturaReserva = calcularAltura(reserva.horaInicio, reserva.horaFin, bloque);
            if (misReservasEnBloque.includes(reserva)) {
              fila += `<div class="parte-reservada" style="top: ${calcularPosicion(reserva.horaInicio, bloque)}%; height: ${alturaReserva}%">
                <div class="curso-nombre">Mi reserva</div>
                <div class="curso-detalle">${reserva.horaInicio}-${reserva.horaFin}</div>
              </div>`;
            } else {
              fila += `<div class="parte-reservada" style="top: ${calcularPosicion(reserva.horaInicio, bloque)}%; height: ${alturaReserva}%">
                <div class="curso-nombre">${reserva.curso}</div>
                <div class="curso-detalle">${reserva.profesor}</div>
              </div>`;
            }
            
            tiempoActual = reserva.horaFin;
          });
          
          // Añadir espacio disponible después de la última reserva si existe
          if (tiempoActual !== bloque.fin) {
            const altura = calcularAltura(tiempoActual, bloque.fin, bloque);
            fila += `<div class="parte-disponible" style="top: ${calcularPosicion(tiempoActual, bloque)}%; height: ${altura}%" onclick="abrirModalDesdeParte('${dia}', '${tiempoActual}', '${bloque.fin}')"></div>`;
          }
          
          fila += `</div></td>`;
        }
      } else {
        // No hay reservas, todo el bloque está disponible
        fila += `<td><div class="disponible" onclick="abrirModal('${dia}','${bloque.inicio}','${bloque.fin}')">
          <i class="fas fa-check-circle"></i> Disponible
        </div></td>`;
      }
    });
    
    fila += "</tr>";
    tbody.innerHTML += fila;
  });
}

// verificar si un horario está dentro de un bloque
function estaEnBloque(horaInicio, horaFin, bloqueInicio, bloqueFin) {
  return horaInicio < bloqueFin && horaFin > bloqueInicio;
}

// Calcular la posición vertical de un horario dentro de un bloque
function calcularPosicion(hora, bloque) {
  const inicioMinutos = horaAMinutos(bloque.inicio);
  const finMinutos = horaAMinutos(bloque.fin);
  const horaMinutos = horaAMinutos(hora);
  
  return ((horaMinutos - inicioMinutos) / (finMinutos - inicioMinutos)) * 100;
}

// altura de un segmento dentro de un bloque
function calcularAltura(horaInicio, horaFin, bloque) {
  const inicioMinutos = horaAMinutos(bloque.inicio);
  const finMinutos = horaAMinutos(bloque.fin);
  const inicioSegmento = horaAMinutos(horaInicio);
  const finSegmento = horaAMinutos(horaFin);
  
  return ((finSegmento - inicioSegmento) / (finMinutos - inicioMinutos)) * 100;
}

//haora a minutos
function horaAMinutos(hora) {
  const [h, m] = hora.split(':').map(Number);
  return h * 60 + m;
}

// minutos a hora
function minutosAHora(minutos) {
  const h = Math.floor(minutos / 60);
  const m = minutos % 60;
  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
}

// reserva
let diaActual = null;
let bloqueInicio = null;
let bloqueFin = null;

function abrirModal(dia, horaInicioBloque, horaFinBloque){
  diaActual = dia;
  bloqueInicio = horaInicioBloque;
  bloqueFin = horaFinBloque;
  
  const modal = document.getElementById("reservaModal");
  modal.classList.add("active");
  
  // reseteo de fromulario
  document.getElementById("motivoReserva").value = "";
  document.getElementById("reservaDescripcion").value = "";
  
  document.getElementById("diaSeleccionado").textContent = dia;
  document.getElementById("bloqueSeleccionado").textContent = `${horaInicioBloque} - ${horaFinBloque}`;
  document.getElementById("responsableInfo").textContent = profesorActual;
  
  //  rango disponible desde el inicio del bloque
  const rangoDisponible = calcularRangoDisponible(dia, horaInicioBloque);
  document.getElementById("rangoDisponible").textContent = `${rangoDisponible.inicio} - ${rangoDisponible.fin}`;
  
  const s1 = document.getElementById("horaInicio");
  const s2 = document.getElementById("horaFin");
  
  s1.innerHTML = "";
  s2.innerHTML = "";
  
  // opciones de hora inicio 
  let inicioIndex = horarios.indexOf(horaInicioBloque);
  let finIndex = horarios.indexOf(rangoDisponible.fin);
  
  for(let i = inicioIndex; i < finIndex; i++) {
    s1.innerHTML += `<option value="${horarios[i]}">${horarios[i]}</option>`;
  }
  
  // opciones de hora fin 
  s1.onchange = function() {
    s2.innerHTML = '<option value="">Seleccionar hora fin</option>';
    const inicioSeleccionado = this.value;
    if(inicioSeleccionado) {
      let inicioIdx = horarios.indexOf(inicioSeleccionado);
      for(let i = inicioIdx + 1; i <= finIndex; i++) {
        s2.innerHTML += `<option value="${horarios[i]}">${horarios[i]}</option>`;
      }
    }
  };
  
  // seleccion de primera hora por defecto
  if(s1.options.length > 0) {
    s1.selectedIndex = 0;
    s1.onchange();
  }
}

function abrirModalDesdeParte(dia, horaInicioParte, horaFinParte) {
  diaActual = dia;
  bloqueInicio = horaInicioParte;
  bloqueFin = horaFinParte;
  
  const modal = document.getElementById("reservaModal");
  modal.classList.add("active");
  
  // reseteo del formulario cada vez que se abre
  document.getElementById("motivoReserva").value = "";
  document.getElementById("reservaDescripcion").value = "";
  
  document.getElementById("diaSeleccionado").textContent = dia;
  document.getElementById("bloqueSeleccionado").textContent = `${horaInicioParte} - ${horaFinParte}`;
  document.getElementById("responsableInfo").textContent = profesorActual;
  
  // El rango disponible es la parte seleccionada
  document.getElementById("rangoDisponible").textContent = `${horaInicioParte} - ${horaFinParte}`;
  
  const s1 = document.getElementById("horaInicio");
  const s2 = document.getElementById("horaFin");
  
  s1.innerHTML = "";
  s2.innerHTML = "";
  
  //  opciones de hora inicio 
  let inicioIndex = horarios.indexOf(horaInicioParte);
  let finIndex = horarios.indexOf(horaFinParte);
  
  for(let i = inicioIndex; i < finIndex; i++) {
    s1.innerHTML += `<option value="${horarios[i]}">${horarios[i]}</option>`;
  }
  
  //  opciones de hora fin
  s1.onchange = function() {
    s2.innerHTML = '<option value="">Seleccionar hora fin</option>';
    const inicioSeleccionado = this.value;
    if(inicioSeleccionado) {
      let inicioIdx = horarios.indexOf(inicioSeleccionado);
      for(let i = inicioIdx + 1; i <= finIndex; i++) {
        s2.innerHTML += `<option value="${horarios[i]}">${horarios[i]}</option>`;
      }
    }
  };
  
  //  primera hora por defecto
  if(s1.options.length > 0) {
    s1.selectedIndex = 0;
    s1.onchange();
  }
}

function calcularRangoDisponible(dia, horaInicio) {
  // todas las reservas para este ambiente y día
  const reservasDia = reservasExistentes
    .filter(r => r.ambiente === ambienteSel.id && r.dia === dia)
    .concat(misReservas.filter(r => r.ambiente === ambienteSel.id && r.dia === dia))
    .sort((a, b) => horarios.indexOf(a.horaInicio) - horarios.indexOf(b.horaInicio));
  
  let inicioDisponible = horaInicio;
  let finDisponible = horarios[horarios.length - 1]; // Última hora disponible
  
  //  la primera reserva que empiece después del inicio
  for(const reserva of reservasDia) {
    if(horarios.indexOf(reserva.horaInicio) >= horarios.indexOf(horaInicio)) {
      finDisponible = reserva.horaInicio;
      break;
    }
  }
  
  return {
    inicio: inicioDisponible,
    fin: finDisponible
  };
}

function cerrarModal(){
  document.getElementById("reservaModal").classList.remove("active");
}

// confirmar reserva¡
function confirmarReserva(){
  const hi = document.getElementById("horaInicio").value;
  const hf = document.getElementById("horaFin").value;
  const motivo = document.getElementById("motivoReserva").value;
  const descripcion = document.getElementById("reservaDescripcion").value;
  
  if(!hi || !hf || !motivo) {
    mostrarNotificacion("Debes completar todos los campos obligatorios", "error");
    return;
  }
  
  if(horarios.indexOf(hi) >= horarios.indexOf(hf)) {
    mostrarNotificacion("La hora de fin debe ser posterior a la hora de inicio", "error");
    return;
  }
  
  //  que no haya conflictos con reservas existentes
  const conflicto = reservasExistentes.some(r => 
    r.ambiente === ambienteSel.id && 
    r.dia === diaActual && 
    ((horarios.indexOf(r.horaInicio) < horarios.indexOf(hf) && horarios.indexOf(r.horaFin) > horarios.indexOf(hi)))
  );
  
  if(conflicto) {
    mostrarNotificacion("El horario seleccionado tiene conflictos con reservas existentes", "error");
    return;
  }
  
  // verificar conflicto con mis reservas
  const conflictoPropio = misReservas.some(r => 
    r.ambiente === ambienteSel.id && 
    r.dia === diaActual && 
    ((horarios.indexOf(r.horaInicio) < horarios.indexOf(hf) && horarios.indexOf(r.horaFin) > horarios.indexOf(hi)))
  );
  
  if(conflictoPropio) {
    mostrarNotificacion("Ya tienes una reserva en ese horario", "error");
    return;
  }
  
  misReservas.push({
    ambiente: ambienteSel.id,
    dia: diaActual,
    horaInicio: hi,
    horaFin: hf,
    motivo: motivo,
    descripcion: descripcion,
    responsable: profesorActual
  });
  
  cerrarModal();
  cargarHorario();
  actualizarMisReservas();
  mostrarNotificacion("Reserva confirmada exitosamente", "success");
}

//  panel de mis reservas
function abrirMisReservas(){
  document.getElementById("misReservasSection").classList.add("active");
  
  // Scroll a mis reservas
  document.getElementById("misReservasSection").scrollIntoView({ behavior: 'smooth' });
}

function cerrarMisReservas(){
  document.getElementById("misReservasSection").classList.remove("active");
}

function actualizarMisReservas(){
  const cont = document.getElementById("listaReservas");
  
  if(misReservas.length === 0) {
    cont.innerHTML = `
      <div class="no-reservas">
        <i class="far fa-calendar-times"></i>
        <h3>No tienes reservas activas</h3>
        <p>Selecciona un ambiente y un horario disponible para crear tu primera reserva.</p>
      </div>
    `;
  } else {
    cont.innerHTML = misReservas.map(r =>
      `<div class="reserva-card">
        <div class="reserva-header">
          <div class="reserva-info">
            <h4>${r.ambiente} - ${r.dia}</h4>
            <div class="reserva-details">
              <strong>Horario:</strong> ${r.horaInicio} a ${r.horaFin}<br>
              <strong>Motivo:</strong> ${r.motivo}<br>
              ${r.descripcion ? `<strong>Descripción:</strong> ${r.descripcion}` : ''}
            </div>
          </div>
        </div>
        <div class="reserva-actions">
          <button class="btn btn-danger" onclick="cancelarReserva('${r.ambiente}', '${r.dia}', '${r.horaInicio}')">
            <i class="fas fa-trash"></i> Cancelar
          </button>
        </div>
      </div>`).join("");
  }
}

// Cancelar reserva 
function cancelarReserva(ambiente, dia, horaInicio) {
  if(confirm("¿Estás seguro de que deseas cancelar esta reserva?")) {
    misReservas = misReservas.filter(r => 
      !(r.ambiente === ambiente && r.dia === dia && r.horaInicio === horaInicio)
    );
    cargarHorario();
    actualizarMisReservas();
    mostrarNotificacion("Reserva cancelada exitosamente", "success");
  }
}

// filtros
document.getElementById("filter-type").addEventListener("change", cargarAmbientes);
document.getElementById("filter-capacity").addEventListener("input", cargarAmbientes);
document.getElementById("filter-favorites").addEventListener("change", cargarAmbientes);

// Event listeners
document.getElementById("btnMisReservas").addEventListener("click", abrirMisReservas);
document.getElementById("closeModal").addEventListener("click", cerrarModal);
document.getElementById("reservaForm").addEventListener("submit", function(e) {
  e.preventDefault();
  confirmarReserva();
});

// Cerrar modal al hacer clic fuera
document.getElementById("reservaModal").addEventListener("click", function(e) {
  if (e.target === this) {
    cerrarModal();
  }
});

cargarAmbientes();
actualizarMisReservas();
</script>
</body>
</html>